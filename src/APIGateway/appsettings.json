{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*",
  "Authentication": {
    "Authority": "https://login.microsoftonline.com/{TenantId}/v2.0",
    "Audience": "{ClientId}",
    "ValidIssuers": [ "https://login.microsoftonline.com/{TenantId}/v2.0" ],
    "ValidAudiences": [
      "api://{ClientId}",
      "{ClientId}"
    ],
    "ClockSkewMinutes": 5
  },
  "AdminRole": {
    "RequiredClaims": [
      {
        "Type": "",
        "Value": ""
      }
    ]
  },
  "Routes": [
    {
      "Key": "Cart",
      "SwaggerKey": "Cart",
      "UpstreamHttpMethod": [ "GET", "POST", "PUT", "PATCH", "DELETE" ],
      "UpstreamPathTemplate": "/cart/{everything}",
      "DownstreamPathTemplate": "/{everything}",
      "DownstreamHostAndPorts": [
        {
          "Host": "localhost",
          "Port": 6010
        }
      ]
    },
    {
      "Key": "CatalogGetProducts",
      "SwaggerKey": "Catalog",
      "UpstreamHttpMethod": [ "GET" ],
      "UpstreamPathTemplate": "/catalog/api/v{version}/products",
      "DownstreamPathTemplate": "/api/v{version}/products",
      "DownstreamHostAndPorts": [
        {
          "Host": "localhost",
          "Port": 6011
        }
      ]
    },
    {
      "Key": "CatalogGetCategories",
      "SwaggerKey": "Catalog",
      "UpstreamHttpMethod": [ "GET" ],
      "UpstreamPathTemplate": "/catalog/api/v{version}/categories",
      "DownstreamPathTemplate": "/api/v{version}/categories",
      "DownstreamHostAndPorts": [
        {
          "Host": "localhost",
          "Port": 6011
        }
      ]
    },
    {
      "Key": "CatalogGetProductProperties",
      "SwaggerKey": "Catalog",
      "UpstreamHttpMethod": [ "GET" ],
      "UpstreamPathTemplate": "/catalog/api/v{version}/Products/{id}/properties",
      "DownstreamPathTemplate": "/api/v{version}/Products/{id}/properties",
      "DownstreamHostAndPorts": [
        {
          "Host": "localhost",
          "Port": 6011
        }
      ]
    },
    {
      "Key": "CatalogGetProductDetails",
      "SwaggerKey": "Catalog",
      "UpstreamHttpMethod": [ "GET" ],
      "UpstreamPathTemplate": "/catalog/api/v{version}/Products/{id}",
      "DownstreamPathTemplate": "/api/v{version}/Products/{id}",
      "DownstreamHostAndPorts": [
        {
          "Host": "localhost",
          "Port": 6011
        }
      ]
    },
    {
      "Key": "CatalogGet",
      "SwaggerKey": "Catalog",
      "UpstreamHttpMethod": [ "GET" ],
      "UpstreamPathTemplate": "/catalog/{everything}",
      "DownstreamPathTemplate": "/{everything}",
      "DownstreamHostAndPorts": [
        {
          "Host": "localhost",
          "Port": 6011
        }
      ]
    },
    {
      "Key": "Catalog",
      "SwaggerKey": "Catalog",
      "UpstreamHttpMethod": [ "POST", "PUT", "PATCH", "DELETE" ],
      "UpstreamPathTemplate": "/catalog/{everything}",
      "DownstreamPathTemplate": "/{everything}",
      "DownstreamHostAndPorts": [
        {
          "Host": "localhost",
          "Port": 6011
        }
      ],
      "DelegatingHandlers": [ "RequireAdminHandler" ]
    }
  ],
  "Aggregates": [
    {
      "RouteKeys": [ "CatalogGetProductDetails", "CatalogGetProductProperties" ],
      "Description": "Aggregates product details and properties into a single response.",
      "UpstreamPathTemplate": "/gateway/api/v{version}/Products/{id}",
      "Aggregator": "RouteKeysAggregator"
    }
  ],
  "GlobalConfiguration": {
    "DownstreamScheme": "https",
    "BaseUrl": "https://localhost:6009",
    "CacheOptions": {
      "RouteKeys": [ "CatalogGetCategories", "CatalogGetProducts" ],
      "TtlSeconds": 60
    },
    "AuthenticationOptions": {
      "AuthenticationProviderKeys": [ "Bearer" ],
      "AllowedScopes": [
        // Quick check for all routes: user without any listed scopes is unauthorized,
        // eg: "Cart.Access"
      ]
    }
  },
  "SwaggerEndPoints": [
    {
      "Key": "Cart",
      "Config": [
        {
          "Name": "Cart API",
          "Version": "v1",
          "Url": "https://localhost:6010/openapi/v1.json"
        },
        {
          "Name": "Cart API",
          "Version": "v2",
          "Url": "https://localhost:6010/openapi/v2.json"
        }
      ]
    },
    {
      "Key": "Catalog",
      "Config": [
        {
          "Name": "Catalog API",
          "Version": "v1",
          "Url": "https://localhost:6011/openapi/v1.json"
        }
      ]
    }
  ],
  "Serilog": {
    "Using": [ "Serilog.Sinks.Console", "Serilog.Sinks.File", "Serilog.Sinks.ApplicationInsights" ],
    "MinimumLevel": {
      "Default": "Information",
      "Override": {
        "Microsoft.AspNetCore": "Warning",
        "Microsoft.Hosting.Lifetime": "Information",
        "Ocelot": "Warning"
      }
    },
    "WriteTo": [
      {
        "Name": "Console",
        "outputTemplate": "{Timestamp:yyyy-MM-dd HH:mm:ss.fff zzz} [{Level:u3}] [{CorrelationId}] {Message:lj}{NewLine}{Exception}"
      },
      {
        "Name": "File",
        "Args": {
          "path": "logs/ApiGateway-.log",
          "rollingInterval": "Day",
          "retainedFileCountLimit": 7,
          "outputTemplate": "{Timestamp:yyyy-MM-dd HH:mm:ss.fff zzz} [{Level:u3}] [{CorrelationId}] {Message:lj}{NewLine}{Exception}"
        }
      },
      {
        "Name": "ApplicationInsights",
        "Args": {
          "connectionString": "",
          "telemetryConverter": "Serilog.Sinks.ApplicationInsights.TelemetryConverters.TraceTelemetryConverter, Serilog.Sinks.ApplicationInsights",
          "outputTemplate": "{Timestamp:yyyy-MM-dd HH:mm:ss.fff zzz} [{Level:u3}] [{CorrelationId}] {Message:lj}{NewLine}{Exception}"
        }
      }
    ],
    "Enrich": [ "FromLogContext", "WithMachineName", "WithThreadId" ]
  },
  "ApplicationInsights": {
    "ConnectionString": ""
  }
}
